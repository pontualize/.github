name: Registro de Ponto Di√°rio

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'A√ß√£o'
        required: true
        type: choice
        options:
          - entrada
          - saida-almoco
          - retorno-almoco
          - saida
      observacao:
        description: 'Observa√ß√£o (opcional)'
        required: false

jobs:
  registrar-ponto:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Configurar ambiente
        run: |
          mkdir -p registros-ponto
          DATA_ATUAL=$(date +%Y-%m-%d)
          HORA_ATUAL=$(date +%H:%M:%S)
          USUARIO="${{ github.actor }}"
          
          echo "DATA_ATUAL=$DATA_ATUAL" >> $GITHUB_ENV
          echo "HORA_ATUAL=$HORA_ATUAL" >> $GITHUB_ENV
          echo "USUARIO=$USUARIO" >> $GITHUB_ENV
      
      - name: Registrar ponto
        run: |
          ARQUIVO="registros-ponto/${{ env.DATA_ATUAL }}.md"
          
          if [ ! -f "$ARQUIVO" ]; then
            echo "# Registro de Ponto - ${{ env.DATA_ATUAL }}" > "$ARQUIVO"
            echo "" >> "$ARQUIVO"
            echo "## Registros" >> "$ARQUIVO"
            echo "" >> "$ARQUIVO"
          fi
          
          case "${{ github.event.inputs.action }}" in
            entrada)
              TIPO="üü¢ Entrada"
              ;;
            saida-almoco)
              TIPO="üü° Sa√≠da para Almo√ßo"
              ;;
            retorno-almoco)
              TIPO="üü° Retorno do Almo√ßo"
              ;;
            saida)
              TIPO="üî¥ Sa√≠da"
              ;;
          esac
          
          echo "- **${{ env.HORA_ATUAL }}** - $TIPO - ${{ env.USUARIO }}" >> "$ARQUIVO"
          
          if [ -n "${{ github.event.inputs.observacao }}" ]; then
            echo "  - Observa√ß√£o: ${{ github.event.inputs.observacao }}" >> "$ARQUIVO"
          fi
          
          echo "" >> "$ARQUIVO"
      
      - name: Commit e Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add registros-ponto/
          git commit -m "Registro de ponto: ${{ github.event.inputs.action }} - ${{ env.USUARIO }} √†s ${{ env.HORA_ATUAL }}" || echo "Nada para commitar"
          git push
      
      - name: Notifica√ß√£o
        run: |
          echo "‚úÖ Ponto registrado com sucesso!"
          echo "Usu√°rio: ${{ env.USUARIO }}"
          echo "A√ß√£o: ${{ github.event.inputs.action }}"
          echo "Data/Hora: ${{ env.DATA_ATUAL }} ${{ env.HORA_ATUAL }}"
